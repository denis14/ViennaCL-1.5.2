<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ViennaCL - The Vienna Computing Library: viennacl/linalg/opencl/kernels/compressed_matrix.hpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ViennaCL - The Vienna Computing Library
   &#160;<span id="projectnumber">1.5.2</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">viennacl/linalg/opencl/kernels/compressed_matrix.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="linalg_2opencl_2kernels_2compressed__matrix_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef VIENNACL_LINALG_OPENCL_KERNELS_COMPRESSED_MATRIX_HPP</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define VIENNACL_LINALG_OPENCL_KERNELS_COMPRESSED_MATRIX_HPP</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="tools_8hpp.html" title="Various little tools used here and there in ViennaCL.">viennacl/tools/tools.hpp</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="kernel_8hpp.html" title="Representation of an OpenCL kernel in ViennaCL.">viennacl/ocl/kernel.hpp</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="platform_8hpp.html" title="Implements a OpenCL platform within ViennaCL.">viennacl/ocl/platform.hpp</a>&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="ocl_2utils_8hpp.html" title="Provides OpenCL-related utilities.">viennacl/ocl/utils.hpp</a>&quot;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="opencl_2common_8hpp.html" title="Common implementations shared by OpenCL-based operations.">viennacl/linalg/opencl/common.hpp</a>&quot;</span>
<a name="l00010"></a>00010 
<a name="l00013"></a>00013 <span class="keyword">namespace </span>viennacl
<a name="l00014"></a>00014 {
<a name="l00015"></a>00015   <span class="keyword">namespace </span>linalg
<a name="l00016"></a>00016   {
<a name="l00017"></a>00017     <span class="keyword">namespace </span>opencl
<a name="l00018"></a>00018     {
<a name="l00019"></a>00019       <span class="keyword">namespace </span>kernels
<a name="l00020"></a>00020       {
<a name="l00021"></a>00021 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00025"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#ae034a9ae2635e47824917a3175495957">00025</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#ae034a9ae2635e47824917a3175495957">generate_compressed_matrix_block_trans_lu_backward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00026"></a>00026         {
<a name="l00027"></a>00027           source.append(<span class="stringliteral">&quot;__kernel void block_trans_lu_backward( \n&quot;</span>);
<a name="l00028"></a>00028           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_jumper_U,  \n&quot;</span>);     <span class="comment">//U part (note that U is transposed in memory)</span>
<a name="l00029"></a>00029           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices_U, \n&quot;</span>);
<a name="l00030"></a>00030           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements_U, \n&quot;</span>);
<a name="l00031"></a>00031           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * diagonal_U, \n&quot;</span>);
<a name="l00032"></a>00032           source.append(<span class="stringliteral">&quot;          __global const unsigned int * block_offsets, \n&quot;</span>);
<a name="l00033"></a>00033           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l00034"></a>00034           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00035"></a>00035           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00036"></a>00036           source.append(<span class="stringliteral">&quot;  unsigned int col_start = block_offsets[2*get_group_id(0)]; \n&quot;</span>);
<a name="l00037"></a>00037           source.append(<span class="stringliteral">&quot;  unsigned int col_stop  = block_offsets[2*get_group_id(0)+1]; \n&quot;</span>);
<a name="l00038"></a>00038           source.append(<span class="stringliteral">&quot;  unsigned int row_start; \n&quot;</span>);
<a name="l00039"></a>00039           source.append(<span class="stringliteral">&quot;  unsigned int row_stop; \n&quot;</span>);
<a name="l00040"></a>00040           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; result_entry = 0; \n&quot;</span>);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042           source.append(<span class="stringliteral">&quot;  if (col_start &gt;= col_stop) \n&quot;</span>);
<a name="l00043"></a>00043           source.append(<span class="stringliteral">&quot;    return; \n&quot;</span>);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045             <span class="comment">//backward elimination, using U and diagonal_U</span>
<a name="l00046"></a>00046           source.append(<span class="stringliteral">&quot;  for (unsigned int iter = 0; iter &lt; col_stop - col_start; ++iter) \n&quot;</span>);
<a name="l00047"></a>00047           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00048"></a>00048           source.append(<span class="stringliteral">&quot;    unsigned int col = (col_stop - iter) - 1; \n&quot;</span>);
<a name="l00049"></a>00049           source.append(<span class="stringliteral">&quot;    result_entry = result[col] / diagonal_U[col]; \n&quot;</span>);
<a name="l00050"></a>00050           source.append(<span class="stringliteral">&quot;    row_start = row_jumper_U[col]; \n&quot;</span>);
<a name="l00051"></a>00051           source.append(<span class="stringliteral">&quot;    row_stop  = row_jumper_U[col + 1]; \n&quot;</span>);
<a name="l00052"></a>00052           source.append(<span class="stringliteral">&quot;    for (unsigned int buffer_index = row_start + get_local_id(0); buffer_index &lt; row_stop; buffer_index += get_local_size(0)) \n&quot;</span>);
<a name="l00053"></a>00053           source.append(<span class="stringliteral">&quot;      result[column_indices_U[buffer_index]] -= result_entry * elements_U[buffer_index]; \n&quot;</span>);
<a name="l00054"></a>00054           source.append(<span class="stringliteral">&quot;    barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00055"></a>00055           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057             <span class="comment">//divide result vector by diagonal:</span>
<a name="l00058"></a>00058           source.append(<span class="stringliteral">&quot;  for (unsigned int col = col_start + get_local_id(0); col &lt; col_stop; col += get_local_size(0)) \n&quot;</span>);
<a name="l00059"></a>00059           source.append(<span class="stringliteral">&quot;    result[col] /= diagonal_U[col]; \n&quot;</span>);
<a name="l00060"></a>00060           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00061"></a>00061         }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00064"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#af303cc8927bc3574bd29e0bdae342b01">00064</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#af303cc8927bc3574bd29e0bdae342b01">generate_compressed_matrix_block_trans_unit_lu_forward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00065"></a>00065         {
<a name="l00066"></a>00066           source.append(<span class="stringliteral">&quot;__kernel void block_trans_unit_lu_forward( \n&quot;</span>);
<a name="l00067"></a>00067           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_jumper_L,  \n&quot;</span>);     <span class="comment">//L part (note that L is transposed in memory)</span>
<a name="l00068"></a>00068           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices_L, \n&quot;</span>);
<a name="l00069"></a>00069           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements_L, \n&quot;</span>);
<a name="l00070"></a>00070           source.append(<span class="stringliteral">&quot;          __global const unsigned int * block_offsets, \n&quot;</span>);
<a name="l00071"></a>00071           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l00072"></a>00072           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00073"></a>00073           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00074"></a>00074           source.append(<span class="stringliteral">&quot;  unsigned int col_start = block_offsets[2*get_group_id(0)]; \n&quot;</span>);
<a name="l00075"></a>00075           source.append(<span class="stringliteral">&quot;  unsigned int col_stop  = block_offsets[2*get_group_id(0)+1]; \n&quot;</span>);
<a name="l00076"></a>00076           source.append(<span class="stringliteral">&quot;  unsigned int row_start = row_jumper_L[col_start]; \n&quot;</span>);
<a name="l00077"></a>00077           source.append(<span class="stringliteral">&quot;  unsigned int row_stop; \n&quot;</span>);
<a name="l00078"></a>00078           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; result_entry = 0; \n&quot;</span>);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080           source.append(<span class="stringliteral">&quot;  if (col_start &gt;= col_stop) \n&quot;</span>);
<a name="l00081"></a>00081           source.append(<span class="stringliteral">&quot;    return; \n&quot;</span>);
<a name="l00082"></a>00082 
<a name="l00083"></a>00083             <span class="comment">//forward elimination, using L:</span>
<a name="l00084"></a>00084           source.append(<span class="stringliteral">&quot;  for (unsigned int col = col_start; col &lt; col_stop; ++col) \n&quot;</span>);
<a name="l00085"></a>00085           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00086"></a>00086           source.append(<span class="stringliteral">&quot;    result_entry = result[col]; \n&quot;</span>);
<a name="l00087"></a>00087           source.append(<span class="stringliteral">&quot;    row_stop = row_jumper_L[col + 1]; \n&quot;</span>);
<a name="l00088"></a>00088           source.append(<span class="stringliteral">&quot;    for (unsigned int buffer_index = row_start + get_local_id(0); buffer_index &lt; row_stop; buffer_index += get_local_size(0)) \n&quot;</span>);
<a name="l00089"></a>00089           source.append(<span class="stringliteral">&quot;      result[column_indices_L[buffer_index]] -= result_entry * elements_L[buffer_index]; \n&quot;</span>);
<a name="l00090"></a>00090           source.append(<span class="stringliteral">&quot;    row_start = row_stop; \n&quot;</span>); <span class="comment">//for next iteration (avoid unnecessary loads from GPU RAM)</span>
<a name="l00091"></a>00091           source.append(<span class="stringliteral">&quot;    barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00092"></a>00092           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094           source.append(<span class="stringliteral">&quot;}; \n&quot;</span>);
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         <span class="keyword">namespace </span>detail
<a name="l00098"></a>00098         {
<a name="l00100"></a>00100           <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00101"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04">00101</a>           <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">generate_compressed_matrix_dense_matrix_mult</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string,
<a name="l00102"></a>00102                                                             <span class="keywordtype">bool</span> B_transposed, <span class="keywordtype">bool</span> B_row_major, <span class="keywordtype">bool</span> C_row_major)
<a name="l00103"></a>00103           {
<a name="l00104"></a>00104             source.append(<span class="stringliteral">&quot;__kernel void &quot;</span>);
<a name="l00105"></a>00105             source.append(<a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1detail.html#a7acbdad2a5672bc7129b8a7662a282bb" title="Returns the OpenCL kernel string for the operation C = A * B with A sparse, B, C dense matrices...">viennacl::linalg::opencl::detail::sparse_dense_matmult_kernel_name</a>(B_transposed, B_row_major, C_row_major));
<a name="l00106"></a>00106             source.append(<span class="stringliteral">&quot;( \n&quot;</span>);
<a name="l00107"></a>00107             source.append(<span class="stringliteral">&quot;          __global const unsigned int * sp_mat_row_indices, \n&quot;</span>);
<a name="l00108"></a>00108             source.append(<span class="stringliteral">&quot;          __global const unsigned int * sp_mat_col_indices, \n&quot;</span>);
<a name="l00109"></a>00109             source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * sp_mat_elements, \n&quot;</span>);
<a name="l00110"></a>00110             source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * d_mat, \n&quot;</span>);
<a name="l00111"></a>00111             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_row_start, \n&quot;</span>);
<a name="l00112"></a>00112             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_col_start, \n&quot;</span>);
<a name="l00113"></a>00113             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_row_inc, \n&quot;</span>);
<a name="l00114"></a>00114             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_col_inc, \n&quot;</span>);
<a name="l00115"></a>00115             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_row_size, \n&quot;</span>);
<a name="l00116"></a>00116             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_col_size, \n&quot;</span>);
<a name="l00117"></a>00117             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_internal_rows, \n&quot;</span>);
<a name="l00118"></a>00118             source.append(<span class="stringliteral">&quot;          unsigned int d_mat_internal_cols, \n&quot;</span>);
<a name="l00119"></a>00119             source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l00120"></a>00120             source.append(<span class="stringliteral">&quot;          unsigned int result_row_start, \n&quot;</span>);
<a name="l00121"></a>00121             source.append(<span class="stringliteral">&quot;          unsigned int result_col_start, \n&quot;</span>);
<a name="l00122"></a>00122             source.append(<span class="stringliteral">&quot;          unsigned int result_row_inc, \n&quot;</span>);
<a name="l00123"></a>00123             source.append(<span class="stringliteral">&quot;          unsigned int result_col_inc, \n&quot;</span>);
<a name="l00124"></a>00124             source.append(<span class="stringliteral">&quot;          unsigned int result_row_size, \n&quot;</span>);
<a name="l00125"></a>00125             source.append(<span class="stringliteral">&quot;          unsigned int result_col_size, \n&quot;</span>);
<a name="l00126"></a>00126             source.append(<span class="stringliteral">&quot;          unsigned int result_internal_rows, \n&quot;</span>);
<a name="l00127"></a>00127             source.append(<span class="stringliteral">&quot;          unsigned int result_internal_cols) { \n&quot;</span>);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129               <span class="comment">// split work rows (sparse matrix rows) to thread groups</span>
<a name="l00130"></a>00130             source.append(<span class="stringliteral">&quot;  for (unsigned int row = get_group_id(0); row &lt; result_row_size; row += get_num_groups(0)) { \n&quot;</span>);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132             source.append(<span class="stringliteral">&quot;    unsigned int row_start = sp_mat_row_indices[row]; \n&quot;</span>);
<a name="l00133"></a>00133             source.append(<span class="stringliteral">&quot;    unsigned int row_end = sp_mat_row_indices[row+1]; \n&quot;</span>);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                 <span class="comment">// split result cols between threads in a thread group</span>
<a name="l00136"></a>00136             source.append(<span class="stringliteral">&quot;    for ( unsigned int col = get_local_id(0); col &lt; result_col_size; col += get_local_size(0) ) { \n&quot;</span>);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138             source.append(<span class="stringliteral">&quot;      &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; r = 0; \n&quot;</span>);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140             source.append(<span class="stringliteral">&quot;      for (unsigned int k = row_start; k &lt; row_end; k ++) { \n&quot;</span>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142             source.append(<span class="stringliteral">&quot;        unsigned int j = sp_mat_col_indices[k]; \n&quot;</span>);
<a name="l00143"></a>00143             source.append(<span class="stringliteral">&quot;        &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; x = sp_mat_elements[k]; \n&quot;</span>);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145             source.append(<span class="stringliteral">&quot;        &quot;</span>); source.append(numeric_string);
<a name="l00146"></a>00146             <span class="keywordflow">if</span> (B_transposed &amp;&amp; B_row_major)
<a name="l00147"></a>00147               source.append(<span class="stringliteral">&quot; y = d_mat[ (d_mat_row_start + col * d_mat_row_inc) * d_mat_internal_cols + d_mat_col_start +   j * d_mat_col_inc ]; \n&quot;</span>);
<a name="l00148"></a>00148             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (B_transposed &amp;&amp; !B_row_major)
<a name="l00149"></a>00149               source.append(<span class="stringliteral">&quot; y = d_mat[ (d_mat_row_start + col * d_mat_row_inc)                       + (d_mat_col_start +  j * d_mat_col_inc) * d_mat_internal_rows ]; \n&quot;</span>);
<a name="l00150"></a>00150             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!B_transposed &amp;&amp; B_row_major)
<a name="l00151"></a>00151               source.append(<span class="stringliteral">&quot; y = d_mat[ (d_mat_row_start +   j * d_mat_row_inc) * d_mat_internal_cols + d_mat_col_start + col * d_mat_col_inc ]; \n&quot;</span>);
<a name="l00152"></a>00152             <span class="keywordflow">else</span>
<a name="l00153"></a>00153               source.append(<span class="stringliteral">&quot; y = d_mat[ (d_mat_row_start +   j * d_mat_row_inc)                       + (d_mat_col_start + col * d_mat_col_inc) * d_mat_internal_rows ]; \n&quot;</span>);
<a name="l00154"></a>00154             source.append(<span class="stringliteral">&quot;        r += x * y; \n&quot;</span>);
<a name="l00155"></a>00155             source.append(<span class="stringliteral">&quot;      } \n&quot;</span>);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157             <span class="keywordflow">if</span> (C_row_major)
<a name="l00158"></a>00158               source.append(<span class="stringliteral">&quot;      result[ (result_row_start + row * result_row_inc) * result_internal_cols + result_col_start + col * result_col_inc ] = r; \n&quot;</span>);
<a name="l00159"></a>00159             <span class="keywordflow">else</span>
<a name="l00160"></a>00160               source.append(<span class="stringliteral">&quot;      result[ (result_row_start + row * result_row_inc)                        + (result_col_start + col * result_col_inc) * result_internal_rows ] = r; \n&quot;</span>);
<a name="l00161"></a>00161             source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00162"></a>00162             source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164             source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166           }
<a name="l00167"></a>00167         }
<a name="l00168"></a>00168         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00169"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a2e6ec11f4c700faff4c4038360582dc7">00169</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a2e6ec11f4c700faff4c4038360582dc7">generate_compressed_matrix_dense_matrix_multiplication</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00170"></a>00170         {
<a name="l00171"></a>00171           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00172"></a>00172           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">false</span>, <span class="keyword">false</span>,  <span class="keyword">true</span>);
<a name="l00173"></a>00173           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">false</span>,  <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l00174"></a>00174           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">false</span>,  <span class="keyword">true</span>,  <span class="keyword">true</span>);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00177"></a>00177           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">true</span>, <span class="keyword">false</span>,  <span class="keyword">true</span>);
<a name="l00178"></a>00178           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">true</span>,  <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l00179"></a>00179           <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels_1_1detail.html#a1f036189f48f1aeef396c562422deb04" title="Generate kernel for C = A * B with A being a compressed_matrix, B and C dense.">detail::generate_compressed_matrix_dense_matrix_mult</a>(source, numeric_string, <span class="keyword">true</span>,  <span class="keyword">true</span>,  <span class="keyword">true</span>);
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00183"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#af568d2205ae5ee359991aaf0020e79e9">00183</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#af568d2205ae5ee359991aaf0020e79e9">generate_compressed_matrix_jacobi</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00184"></a>00184         {
<a name="l00185"></a>00185 
<a name="l00186"></a>00186          source.append(<span class="stringliteral">&quot; __kernel void jacobi( \n&quot;</span>);
<a name="l00187"></a>00187          source.append(<span class="stringliteral">&quot;  __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00188"></a>00188          source.append(<span class="stringliteral">&quot;  __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00189"></a>00189          source.append(<span class="stringliteral">&quot;  __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00190"></a>00190          source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; weight, \n&quot;</span>);
<a name="l00191"></a>00191          source.append(<span class="stringliteral">&quot;  __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * old_result, \n&quot;</span>);
<a name="l00192"></a>00192          source.append(<span class="stringliteral">&quot;  __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * new_result, \n&quot;</span>);
<a name="l00193"></a>00193          source.append(<span class="stringliteral">&quot;  __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * rhs, \n&quot;</span>);
<a name="l00194"></a>00194          source.append(<span class="stringliteral">&quot;  unsigned int size) \n&quot;</span>);
<a name="l00195"></a>00195          source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00196"></a>00196          source.append(<span class="stringliteral">&quot;   &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; sum, diag=1; \n&quot;</span>);
<a name="l00197"></a>00197          source.append(<span class="stringliteral">&quot;   int col; \n&quot;</span>);
<a name="l00198"></a>00198          source.append(<span class="stringliteral">&quot;   for (unsigned int i = get_global_id(0); i &lt; size; i += get_global_size(0)) \n&quot;</span>);
<a name="l00199"></a>00199          source.append(<span class="stringliteral">&quot;   { \n&quot;</span>);
<a name="l00200"></a>00200          source.append(<span class="stringliteral">&quot;     sum = 0; \n&quot;</span>);
<a name="l00201"></a>00201          source.append(<span class="stringliteral">&quot;     for (unsigned int j = row_indices[i]; j&lt;row_indices[i+1]; j++) \n&quot;</span>);
<a name="l00202"></a>00202          source.append(<span class="stringliteral">&quot;     { \n&quot;</span>);
<a name="l00203"></a>00203          source.append(<span class="stringliteral">&quot;       col = column_indices[j]; \n&quot;</span>);
<a name="l00204"></a>00204          source.append(<span class="stringliteral">&quot;       if (i == col) \n&quot;</span>);
<a name="l00205"></a>00205          source.append(<span class="stringliteral">&quot;   diag = elements[j]; \n&quot;</span>);
<a name="l00206"></a>00206          source.append(<span class="stringliteral">&quot;       else \n&quot;</span>);
<a name="l00207"></a>00207          source.append(<span class="stringliteral">&quot;   sum += elements[j] * old_result[col]; \n&quot;</span>);
<a name="l00208"></a>00208          source.append(<span class="stringliteral">&quot;     } \n&quot;</span>);
<a name="l00209"></a>00209          source.append(<span class="stringliteral">&quot;       new_result[i] = weight * (rhs[i]-sum) / diag + (1-weight) * old_result[i]; \n&quot;</span>);
<a name="l00210"></a>00210          source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00211"></a>00211          source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00216"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#aaaaa136ff06f88b86de6e5fc910414fb">00216</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#aaaaa136ff06f88b86de6e5fc910414fb">generate_compressed_matrix_lu_backward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00217"></a>00217         {
<a name="l00218"></a>00218           <span class="comment">// compute x in Ux = y for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00219"></a>00219           source.append(<span class="stringliteral">&quot;__kernel void lu_backward( \n&quot;</span>);
<a name="l00220"></a>00220           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00221"></a>00221           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00222"></a>00222           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00223"></a>00223           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00224"></a>00224           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00225"></a>00225           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00226"></a>00226           source.append(<span class="stringliteral">&quot;  __local unsigned int col_index_buffer[128]; \n&quot;</span>);
<a name="l00227"></a>00227           source.append(<span class="stringliteral">&quot;  __local &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; element_buffer[128]; \n&quot;</span>);
<a name="l00228"></a>00228           source.append(<span class="stringliteral">&quot;  __local &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; vector_buffer[128]; \n&quot;</span>);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00231"></a>00231           source.append(<span class="stringliteral">&quot;  unsigned int current_row = size-1; \n&quot;</span>);
<a name="l00232"></a>00232           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = size-1; \n&quot;</span>);
<a name="l00233"></a>00233           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; current_vector_entry = vector[size-1]; \n&quot;</span>);
<a name="l00234"></a>00234           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; diagonal_entry = 0; \n&quot;</span>);
<a name="l00235"></a>00235           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = ( (nnz - 1) / get_local_size(0)) * get_local_size(0); \n&quot;</span>);
<a name="l00236"></a>00236           source.append(<span class="stringliteral">&quot;  unsigned int next_row = row_indices[size-1]; \n&quot;</span>);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238           source.append(<span class="stringliteral">&quot;  unsigned int i = loop_end + get_local_id(0); \n&quot;</span>);
<a name="l00239"></a>00239           source.append(<span class="stringliteral">&quot;  while (1) \n&quot;</span>);
<a name="l00240"></a>00240           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00241"></a>00241               <span class="comment">//load into shared memory (coalesced access):</span>
<a name="l00242"></a>00242           source.append(<span class="stringliteral">&quot;    if (i &lt; nnz) \n&quot;</span>);
<a name="l00243"></a>00243           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00244"></a>00244           source.append(<span class="stringliteral">&quot;      element_buffer[get_local_id(0)] = elements[i]; \n&quot;</span>);
<a name="l00245"></a>00245           source.append(<span class="stringliteral">&quot;      unsigned int tmp = column_indices[i]; \n&quot;</span>);
<a name="l00246"></a>00246           source.append(<span class="stringliteral">&quot;      col_index_buffer[get_local_id(0)] = tmp; \n&quot;</span>);
<a name="l00247"></a>00247           source.append(<span class="stringliteral">&quot;      vector_buffer[get_local_id(0)] = vector[tmp]; \n&quot;</span>);
<a name="l00248"></a>00248           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252               <span class="comment">//now a single thread does the remaining work in shared memory:</span>
<a name="l00253"></a>00253           source.append(<span class="stringliteral">&quot;    if (get_local_id(0) == 0) \n&quot;</span>);
<a name="l00254"></a>00254           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00255"></a>00255                 <span class="comment">// traverse through all the loaded data from back to front:</span>
<a name="l00256"></a>00256           source.append(<span class="stringliteral">&quot;      for (unsigned int k2=0; k2&lt;get_local_size(0); ++k2) \n&quot;</span>);
<a name="l00257"></a>00257           source.append(<span class="stringliteral">&quot;      { \n&quot;</span>);
<a name="l00258"></a>00258           source.append(<span class="stringliteral">&quot;        unsigned int k = (get_local_size(0) - k2) - 1; \n&quot;</span>);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260           source.append(<span class="stringliteral">&quot;        if (i+k &gt;= nnz) \n&quot;</span>);
<a name="l00261"></a>00261           source.append(<span class="stringliteral">&quot;          continue; \n&quot;</span>);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263           source.append(<span class="stringliteral">&quot;        if (col_index_buffer[k] &gt; row_at_window_start) \n&quot;</span>); <span class="comment">//use recently computed results</span>
<a name="l00264"></a>00264           source.append(<span class="stringliteral">&quot;          current_vector_entry -= element_buffer[k] * vector_buffer[k]; \n&quot;</span>);
<a name="l00265"></a>00265           source.append(<span class="stringliteral">&quot;        else if (col_index_buffer[k] &gt; current_row) \n&quot;</span>); <span class="comment">//use buffered data</span>
<a name="l00266"></a>00266           source.append(<span class="stringliteral">&quot;          current_vector_entry -= element_buffer[k] * vector[col_index_buffer[k]]; \n&quot;</span>);
<a name="l00267"></a>00267           source.append(<span class="stringliteral">&quot;        else if (col_index_buffer[k] == current_row) \n&quot;</span>);
<a name="l00268"></a>00268           source.append(<span class="stringliteral">&quot;          diagonal_entry = element_buffer[k]; \n&quot;</span>);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270           source.append(<span class="stringliteral">&quot;        if (i+k == next_row) \n&quot;</span>); <span class="comment">//current row is finished. Write back result</span>
<a name="l00271"></a>00271           source.append(<span class="stringliteral">&quot;        { \n&quot;</span>);
<a name="l00272"></a>00272           source.append(<span class="stringliteral">&quot;          vector[current_row] = current_vector_entry / diagonal_entry; \n&quot;</span>);
<a name="l00273"></a>00273           source.append(<span class="stringliteral">&quot;          if (current_row &gt; 0) //load next row&#39;s data \n&quot;</span>);
<a name="l00274"></a>00274           source.append(<span class="stringliteral">&quot;          { \n&quot;</span>);
<a name="l00275"></a>00275           source.append(<span class="stringliteral">&quot;            --current_row; \n&quot;</span>);
<a name="l00276"></a>00276           source.append(<span class="stringliteral">&quot;            next_row = row_indices[current_row]; \n&quot;</span>);
<a name="l00277"></a>00277           source.append(<span class="stringliteral">&quot;            current_vector_entry = vector[current_row]; \n&quot;</span>);
<a name="l00278"></a>00278           source.append(<span class="stringliteral">&quot;          } \n&quot;</span>);
<a name="l00279"></a>00279           source.append(<span class="stringliteral">&quot;        } \n&quot;</span>);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282           source.append(<span class="stringliteral">&quot;      } \n&quot;</span>); <span class="comment">// for k</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284           source.append(<span class="stringliteral">&quot;      row_at_window_start = current_row; \n&quot;</span>);
<a name="l00285"></a>00285           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>); <span class="comment">// if (get_local_id(0) == 0)</span>
<a name="l00286"></a>00286 
<a name="l00287"></a>00287           source.append(<span class="stringliteral">&quot;    barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289           source.append(<span class="stringliteral">&quot;    if (i &lt; get_local_size(0)) \n&quot;</span>);
<a name="l00290"></a>00290           source.append(<span class="stringliteral">&quot;      break; \n&quot;</span>);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292           source.append(<span class="stringliteral">&quot;    i -= get_local_size(0); \n&quot;</span>);
<a name="l00293"></a>00293           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>); <span class="comment">//for i</span>
<a name="l00294"></a>00294           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00299"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a332482e35049c0e2e0d878e07ca4b12d">00299</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a332482e35049c0e2e0d878e07ca4b12d">generate_compressed_matrix_lu_forward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00300"></a>00300         {
<a name="l00301"></a>00301 
<a name="l00302"></a>00302           <span class="comment">// compute y in Ly = z for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00303"></a>00303           source.append(<span class="stringliteral">&quot;__kernel void lu_forward( \n&quot;</span>);
<a name="l00304"></a>00304           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00305"></a>00305           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00306"></a>00306           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00307"></a>00307           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00308"></a>00308           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00309"></a>00309           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00310"></a>00310           source.append(<span class="stringliteral">&quot;  __local unsigned int col_index_buffer[128]; \n&quot;</span>);
<a name="l00311"></a>00311           source.append(<span class="stringliteral">&quot;  __local &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; element_buffer[128]; \n&quot;</span>);
<a name="l00312"></a>00312           source.append(<span class="stringliteral">&quot;  __local &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; vector_buffer[128]; \n&quot;</span>);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00315"></a>00315           source.append(<span class="stringliteral">&quot;  unsigned int current_row = 0; \n&quot;</span>);
<a name="l00316"></a>00316           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = 0; \n&quot;</span>);
<a name="l00317"></a>00317           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; current_vector_entry = vector[0]; \n&quot;</span>);
<a name="l00318"></a>00318           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; diagonal_entry; \n&quot;</span>);
<a name="l00319"></a>00319           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = (nnz / get_local_size(0) + 1) * get_local_size(0); \n&quot;</span>);
<a name="l00320"></a>00320           source.append(<span class="stringliteral">&quot;  unsigned int next_row = row_indices[1]; \n&quot;</span>);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322           source.append(<span class="stringliteral">&quot;  for (unsigned int i = get_local_id(0); i &lt; loop_end; i += get_local_size(0)) \n&quot;</span>);
<a name="l00323"></a>00323           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00324"></a>00324               <span class="comment">//load into shared memory (coalesced access):</span>
<a name="l00325"></a>00325           source.append(<span class="stringliteral">&quot;    if (i &lt; nnz) \n&quot;</span>);
<a name="l00326"></a>00326           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00327"></a>00327           source.append(<span class="stringliteral">&quot;      element_buffer[get_local_id(0)] = elements[i]; \n&quot;</span>);
<a name="l00328"></a>00328           source.append(<span class="stringliteral">&quot;      unsigned int tmp = column_indices[i]; \n&quot;</span>);
<a name="l00329"></a>00329           source.append(<span class="stringliteral">&quot;      col_index_buffer[get_local_id(0)] = tmp; \n&quot;</span>);
<a name="l00330"></a>00330           source.append(<span class="stringliteral">&quot;      vector_buffer[get_local_id(0)] = vector[tmp]; \n&quot;</span>);
<a name="l00331"></a>00331           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335               <span class="comment">//now a single thread does the remaining work in shared memory:</span>
<a name="l00336"></a>00336           source.append(<span class="stringliteral">&quot;    if (get_local_id(0) == 0) \n&quot;</span>);
<a name="l00337"></a>00337           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00338"></a>00338                 <span class="comment">// traverse through all the loaded data:</span>
<a name="l00339"></a>00339           source.append(<span class="stringliteral">&quot;      for (unsigned int k=0; k&lt;get_local_size(0); ++k) \n&quot;</span>);
<a name="l00340"></a>00340           source.append(<span class="stringliteral">&quot;      { \n&quot;</span>);
<a name="l00341"></a>00341           source.append(<span class="stringliteral">&quot;        if (current_row &lt; size &amp;&amp; i+k == next_row) \n&quot;</span>); <span class="comment">//current row is finished. Write back result</span>
<a name="l00342"></a>00342           source.append(<span class="stringliteral">&quot;        { \n&quot;</span>);
<a name="l00343"></a>00343           source.append(<span class="stringliteral">&quot;          vector[current_row] = current_vector_entry / diagonal_entry; \n&quot;</span>);
<a name="l00344"></a>00344           source.append(<span class="stringliteral">&quot;          ++current_row; \n&quot;</span>);
<a name="l00345"></a>00345           source.append(<span class="stringliteral">&quot;          if (current_row &lt; size) \n&quot;</span>); <span class="comment">//load next row&#39;s data</span>
<a name="l00346"></a>00346           source.append(<span class="stringliteral">&quot;          { \n&quot;</span>);
<a name="l00347"></a>00347           source.append(<span class="stringliteral">&quot;            next_row = row_indices[current_row+1]; \n&quot;</span>);
<a name="l00348"></a>00348           source.append(<span class="stringliteral">&quot;            current_vector_entry = vector[current_row]; \n&quot;</span>);
<a name="l00349"></a>00349           source.append(<span class="stringliteral">&quot;          } \n&quot;</span>);
<a name="l00350"></a>00350           source.append(<span class="stringliteral">&quot;        } \n&quot;</span>);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352           source.append(<span class="stringliteral">&quot;        if (current_row &lt; size &amp;&amp; col_index_buffer[k] &lt; current_row) \n&quot;</span>); <span class="comment">//substitute</span>
<a name="l00353"></a>00353           source.append(<span class="stringliteral">&quot;        { \n&quot;</span>);
<a name="l00354"></a>00354           source.append(<span class="stringliteral">&quot;          if (col_index_buffer[k] &lt; row_at_window_start) \n&quot;</span>); <span class="comment">//use recently computed results</span>
<a name="l00355"></a>00355           source.append(<span class="stringliteral">&quot;            current_vector_entry -= element_buffer[k] * vector_buffer[k]; \n&quot;</span>);
<a name="l00356"></a>00356           source.append(<span class="stringliteral">&quot;          else if (col_index_buffer[k] &lt; current_row) \n&quot;</span>); <span class="comment">//use buffered data</span>
<a name="l00357"></a>00357           source.append(<span class="stringliteral">&quot;            current_vector_entry -= element_buffer[k] * vector[col_index_buffer[k]]; \n&quot;</span>);
<a name="l00358"></a>00358           source.append(<span class="stringliteral">&quot;        } \n&quot;</span>);
<a name="l00359"></a>00359           source.append(<span class="stringliteral">&quot;        else if (col_index_buffer[k] == current_row) \n&quot;</span>);
<a name="l00360"></a>00360           source.append(<span class="stringliteral">&quot;          diagonal_entry = element_buffer[k]; \n&quot;</span>);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362           source.append(<span class="stringliteral">&quot;      } \n&quot;</span>); <span class="comment">// for k</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364           source.append(<span class="stringliteral">&quot;      row_at_window_start = current_row; \n&quot;</span>);
<a name="l00365"></a>00365           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>); <span class="comment">// if (get_local_id(0) == 0)</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367           source.append(<span class="stringliteral">&quot;    barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00368"></a>00368           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>); <span class="comment">//for i</span>
<a name="l00369"></a>00369           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00374"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a8c315bc961b2baa1779751171fd1ae0e">00374</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a8c315bc961b2baa1779751171fd1ae0e">generate_compressed_matrix_row_info_extractor</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00375"></a>00375         {
<a name="l00376"></a>00376           source.append(<span class="stringliteral">&quot;__kernel void row_info_extractor( \n&quot;</span>);
<a name="l00377"></a>00377           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00378"></a>00378           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00379"></a>00379           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00380"></a>00380           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l00381"></a>00381           source.append(<span class="stringliteral">&quot;          unsigned int size, \n&quot;</span>);
<a name="l00382"></a>00382           source.append(<span class="stringliteral">&quot;          unsigned int option \n&quot;</span>);
<a name="l00383"></a>00383           source.append(<span class="stringliteral">&quot;          ) \n&quot;</span>);
<a name="l00384"></a>00384           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00385"></a>00385           source.append(<span class="stringliteral">&quot;  for (unsigned int row = get_global_id(0); row &lt; size; row += get_global_size(0)) \n&quot;</span>);
<a name="l00386"></a>00386           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00387"></a>00387           source.append(<span class="stringliteral">&quot;    &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; value = 0; \n&quot;</span>);
<a name="l00388"></a>00388           source.append(<span class="stringliteral">&quot;    unsigned int row_end = row_indices[row+1]; \n&quot;</span>);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390           source.append(<span class="stringliteral">&quot;    switch (option) \n&quot;</span>);
<a name="l00391"></a>00391           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00392"></a>00392           source.append(<span class="stringliteral">&quot;      case 0: \n&quot;</span>); <span class="comment">//inf-norm</span>
<a name="l00393"></a>00393           source.append(<span class="stringliteral">&quot;        for (unsigned int i = row_indices[row]; i &lt; row_end; ++i) \n&quot;</span>);
<a name="l00394"></a>00394           source.append(<span class="stringliteral">&quot;          value = max(value, fabs(elements[i])); \n&quot;</span>);
<a name="l00395"></a>00395           source.append(<span class="stringliteral">&quot;        break; \n&quot;</span>);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397           source.append(<span class="stringliteral">&quot;      case 1: \n&quot;</span>); <span class="comment">//1-norm</span>
<a name="l00398"></a>00398           source.append(<span class="stringliteral">&quot;        for (unsigned int i = row_indices[row]; i &lt; row_end; ++i) \n&quot;</span>);
<a name="l00399"></a>00399           source.append(<span class="stringliteral">&quot;          value += fabs(elements[i]); \n&quot;</span>);
<a name="l00400"></a>00400           source.append(<span class="stringliteral">&quot;        break; \n&quot;</span>);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402           source.append(<span class="stringliteral">&quot;      case 2: \n&quot;</span>); <span class="comment">//2-norm</span>
<a name="l00403"></a>00403           source.append(<span class="stringliteral">&quot;        for (unsigned int i = row_indices[row]; i &lt; row_end; ++i) \n&quot;</span>);
<a name="l00404"></a>00404           source.append(<span class="stringliteral">&quot;          value += elements[i] * elements[i]; \n&quot;</span>);
<a name="l00405"></a>00405           source.append(<span class="stringliteral">&quot;        value = sqrt(value); \n&quot;</span>);
<a name="l00406"></a>00406           source.append(<span class="stringliteral">&quot;        break; \n&quot;</span>);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408           source.append(<span class="stringliteral">&quot;      case 3: \n&quot;</span>); <span class="comment">//diagonal entry</span>
<a name="l00409"></a>00409           source.append(<span class="stringliteral">&quot;        for (unsigned int i = row_indices[row]; i &lt; row_end; ++i) \n&quot;</span>);
<a name="l00410"></a>00410           source.append(<span class="stringliteral">&quot;        { \n&quot;</span>);
<a name="l00411"></a>00411           source.append(<span class="stringliteral">&quot;          if (column_indices[i] == row) \n&quot;</span>);
<a name="l00412"></a>00412           source.append(<span class="stringliteral">&quot;          { \n&quot;</span>);
<a name="l00413"></a>00413           source.append(<span class="stringliteral">&quot;            value = elements[i]; \n&quot;</span>);
<a name="l00414"></a>00414           source.append(<span class="stringliteral">&quot;            break; \n&quot;</span>);
<a name="l00415"></a>00415           source.append(<span class="stringliteral">&quot;          } \n&quot;</span>);
<a name="l00416"></a>00416           source.append(<span class="stringliteral">&quot;        } \n&quot;</span>);
<a name="l00417"></a>00417           source.append(<span class="stringliteral">&quot;        break; \n&quot;</span>);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419           source.append(<span class="stringliteral">&quot;      default: \n&quot;</span>);
<a name="l00420"></a>00420           source.append(<span class="stringliteral">&quot;        break; \n&quot;</span>);
<a name="l00421"></a>00421           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00422"></a>00422           source.append(<span class="stringliteral">&quot;    result[row] = value; \n&quot;</span>);
<a name="l00423"></a>00423           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00424"></a>00424           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00429"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a67279282d74a5e13f77e1c494867a468">00429</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a67279282d74a5e13f77e1c494867a468">generate_compressed_matrix_trans_lu_backward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00430"></a>00430         {
<a name="l00431"></a>00431 
<a name="l00432"></a>00432           <span class="comment">// compute y in Ly = z for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00433"></a>00433           source.append(<span class="stringliteral">&quot;__kernel void trans_lu_backward( \n&quot;</span>);
<a name="l00434"></a>00434           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00435"></a>00435           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00436"></a>00436           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00437"></a>00437           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * diagonal_entries, \n&quot;</span>);
<a name="l00438"></a>00438           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00439"></a>00439           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00440"></a>00440           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00441"></a>00441           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_lookahead[256]; \n&quot;</span>);
<a name="l00442"></a>00442           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_buffer[256]; \n&quot;</span>);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444           source.append(<span class="stringliteral">&quot;  unsigned int row_index; \n&quot;</span>);
<a name="l00445"></a>00445           source.append(<span class="stringliteral">&quot;  unsigned int col_index; \n&quot;</span>);
<a name="l00446"></a>00446           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; matrix_entry; \n&quot;</span>);
<a name="l00447"></a>00447           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00448"></a>00448           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = size; \n&quot;</span>);
<a name="l00449"></a>00449           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_end; \n&quot;</span>);
<a name="l00450"></a>00450           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = ( (nnz - 1) / get_local_size(0) + 1) * get_local_size(0); \n&quot;</span>);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452           source.append(<span class="stringliteral">&quot;  for (unsigned int i2 = get_local_id(0); i2 &lt; loop_end; i2 += get_local_size(0)) \n&quot;</span>);
<a name="l00453"></a>00453           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00454"></a>00454           source.append(<span class="stringliteral">&quot;    unsigned int i = (nnz - i2) - 1; \n&quot;</span>);
<a name="l00455"></a>00455           source.append(<span class="stringliteral">&quot;    col_index    = (i2 &lt; nnz) ? column_indices[i] : 0; \n&quot;</span>);
<a name="l00456"></a>00456           source.append(<span class="stringliteral">&quot;    matrix_entry = (i2 &lt; nnz) ? elements[i]       : 0; \n&quot;</span>);
<a name="l00457"></a>00457           source.append(<span class="stringliteral">&quot;    row_index_lookahead[get_local_id(0)] = (row_at_window_start &gt;= get_local_id(0)) ? row_indices[row_at_window_start - get_local_id(0)] : 0; \n&quot;</span>);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461           source.append(<span class="stringliteral">&quot;    if (i2 &lt; nnz) \n&quot;</span>);
<a name="l00462"></a>00462           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00463"></a>00463           source.append(<span class="stringliteral">&quot;      unsigned int row_index_dec = 0; \n&quot;</span>);
<a name="l00464"></a>00464           source.append(<span class="stringliteral">&quot;      while (row_index_lookahead[row_index_dec] &gt; i) \n&quot;</span>);
<a name="l00465"></a>00465           source.append(<span class="stringliteral">&quot;        ++row_index_dec; \n&quot;</span>);
<a name="l00466"></a>00466           source.append(<span class="stringliteral">&quot;      row_index = row_at_window_start - row_index_dec; \n&quot;</span>);
<a name="l00467"></a>00467           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = row_index; \n&quot;</span>);
<a name="l00468"></a>00468           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00469"></a>00469           source.append(<span class="stringliteral">&quot;    else \n&quot;</span>);
<a name="l00470"></a>00470           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00471"></a>00471           source.append(<span class="stringliteral">&quot;      row_index = size+1; \n&quot;</span>);
<a name="l00472"></a>00472           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = 0; \n&quot;</span>);
<a name="l00473"></a>00473           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_index_buffer[0]; \n&quot;</span>);
<a name="l00478"></a>00478           source.append(<span class="stringliteral">&quot;    row_at_window_end   = row_index_buffer[get_local_size(0) - 1]; \n&quot;</span>);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480               <span class="comment">//backward elimination</span>
<a name="l00481"></a>00481           source.append(<span class="stringliteral">&quot;    for (unsigned int row2 = 0; row2 &lt;= (row_at_window_start - row_at_window_end); ++row2) \n&quot;</span>);
<a name="l00482"></a>00482           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00483"></a>00483           source.append(<span class="stringliteral">&quot;      unsigned int row = row_at_window_start - row2; \n&quot;</span>);
<a name="l00484"></a>00484           source.append(<span class="stringliteral">&quot;      &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; result_entry = vector[row] / diagonal_entries[row]; \n&quot;</span>);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486           source.append(<span class="stringliteral">&quot;      if ( (row_index == row) &amp;&amp; (col_index &lt; row) ) \n&quot;</span>);
<a name="l00487"></a>00487           source.append(<span class="stringliteral">&quot;        vector[col_index] -= result_entry * matrix_entry; \n&quot;</span>);
<a name="l00488"></a>00488 
<a name="l00489"></a>00489           source.append(<span class="stringliteral">&quot;      barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00490"></a>00490           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_at_window_end; \n&quot;</span>);
<a name="l00493"></a>00493           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495             <span class="comment">// final step: Divide vector by diagonal entries:</span>
<a name="l00496"></a>00496           source.append(<span class="stringliteral">&quot;  for (unsigned int i = get_local_id(0); i &lt; size; i += get_local_size(0)) \n&quot;</span>);
<a name="l00497"></a>00497           source.append(<span class="stringliteral">&quot;    vector[i] /= diagonal_entries[i]; \n&quot;</span>);
<a name="l00498"></a>00498           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00503"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a3d3316ebcdccea8c7c4392d4f3114aac">00503</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a3d3316ebcdccea8c7c4392d4f3114aac">generate_compressed_matrix_trans_lu_forward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00504"></a>00504         {
<a name="l00505"></a>00505 
<a name="l00506"></a>00506           <span class="comment">// compute y in Ly = z for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00507"></a>00507           source.append(<span class="stringliteral">&quot;__kernel void trans_lu_forward( \n&quot;</span>);
<a name="l00508"></a>00508           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00509"></a>00509           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00510"></a>00510           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00511"></a>00511           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * diagonal_entries, \n&quot;</span>);
<a name="l00512"></a>00512           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00513"></a>00513           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00514"></a>00514           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00515"></a>00515           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_lookahead[256]; \n&quot;</span>);
<a name="l00516"></a>00516           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_buffer[256]; \n&quot;</span>);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518           source.append(<span class="stringliteral">&quot;  unsigned int row_index; \n&quot;</span>);
<a name="l00519"></a>00519           source.append(<span class="stringliteral">&quot;  unsigned int col_index; \n&quot;</span>);
<a name="l00520"></a>00520           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; matrix_entry; \n&quot;</span>);
<a name="l00521"></a>00521           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00522"></a>00522           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = 0; \n&quot;</span>);
<a name="l00523"></a>00523           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_end = 0; \n&quot;</span>);
<a name="l00524"></a>00524           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = ( (nnz - 1) / get_local_size(0) + 1) * get_local_size(0); \n&quot;</span>);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526           source.append(<span class="stringliteral">&quot;  for (unsigned int i = get_local_id(0); i &lt; loop_end; i += get_local_size(0)) \n&quot;</span>);
<a name="l00527"></a>00527           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00528"></a>00528           source.append(<span class="stringliteral">&quot;    col_index    = (i &lt; nnz) ? column_indices[i] : 0; \n&quot;</span>);
<a name="l00529"></a>00529           source.append(<span class="stringliteral">&quot;    matrix_entry = (i &lt; nnz) ? elements[i]       : 0; \n&quot;</span>);
<a name="l00530"></a>00530           source.append(<span class="stringliteral">&quot;    row_index_lookahead[get_local_id(0)] = (row_at_window_start + get_local_id(0) &lt; size) ? row_indices[row_at_window_start + get_local_id(0)] : size - 1; \n&quot;</span>);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534           source.append(<span class="stringliteral">&quot;    if (i &lt; nnz) \n&quot;</span>);
<a name="l00535"></a>00535           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00536"></a>00536           source.append(<span class="stringliteral">&quot;      unsigned int row_index_inc = 0; \n&quot;</span>);
<a name="l00537"></a>00537           source.append(<span class="stringliteral">&quot;      while (i &gt;= row_index_lookahead[row_index_inc + 1]) \n&quot;</span>);
<a name="l00538"></a>00538           source.append(<span class="stringliteral">&quot;        ++row_index_inc; \n&quot;</span>);
<a name="l00539"></a>00539           source.append(<span class="stringliteral">&quot;      row_index = row_at_window_start + row_index_inc; \n&quot;</span>);
<a name="l00540"></a>00540           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = row_index; \n&quot;</span>);
<a name="l00541"></a>00541           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00542"></a>00542           source.append(<span class="stringliteral">&quot;    else \n&quot;</span>);
<a name="l00543"></a>00543           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00544"></a>00544           source.append(<span class="stringliteral">&quot;      row_index = size+1; \n&quot;</span>);
<a name="l00545"></a>00545           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = size - 1; \n&quot;</span>);
<a name="l00546"></a>00546           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_index_buffer[0]; \n&quot;</span>);
<a name="l00551"></a>00551           source.append(<span class="stringliteral">&quot;    row_at_window_end   = row_index_buffer[get_local_size(0) - 1]; \n&quot;</span>);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553               <span class="comment">//forward elimination</span>
<a name="l00554"></a>00554           source.append(<span class="stringliteral">&quot;    for (unsigned int row = row_at_window_start; row &lt;= row_at_window_end; ++row) \n&quot;</span>);
<a name="l00555"></a>00555           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00556"></a>00556           source.append(<span class="stringliteral">&quot;      &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; result_entry = vector[row] / diagonal_entries[row]; \n&quot;</span>);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558           source.append(<span class="stringliteral">&quot;      if ( (row_index == row) &amp;&amp; (col_index &gt; row) ) \n&quot;</span>);
<a name="l00559"></a>00559           source.append(<span class="stringliteral">&quot;        vector[col_index] -= result_entry * matrix_entry; \n&quot;</span>);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561           source.append(<span class="stringliteral">&quot;      barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00562"></a>00562           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_at_window_end; \n&quot;</span>);
<a name="l00565"></a>00565           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567             <span class="comment">// final step: Divide vector by diagonal entries:</span>
<a name="l00568"></a>00568           source.append(<span class="stringliteral">&quot;  for (unsigned int i = get_local_id(0); i &lt; size; i += get_local_size(0)) \n&quot;</span>);
<a name="l00569"></a>00569           source.append(<span class="stringliteral">&quot;    vector[i] /= diagonal_entries[i]; \n&quot;</span>);
<a name="l00570"></a>00570           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00571"></a>00571 
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00575"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a9be305cd62f71c5d09f20d50fc14857a">00575</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a9be305cd62f71c5d09f20d50fc14857a">generate_compressed_matrix_trans_unit_lu_backward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00576"></a>00576         {
<a name="l00577"></a>00577 
<a name="l00578"></a>00578           <span class="comment">// compute y in Ly = z for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00579"></a>00579           source.append(<span class="stringliteral">&quot;__kernel void trans_unit_lu_backward( \n&quot;</span>);
<a name="l00580"></a>00580           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00581"></a>00581           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00582"></a>00582           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00583"></a>00583           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00584"></a>00584           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00585"></a>00585           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00586"></a>00586           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_lookahead[256]; \n&quot;</span>);
<a name="l00587"></a>00587           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_buffer[256]; \n&quot;</span>);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589           source.append(<span class="stringliteral">&quot;  unsigned int row_index; \n&quot;</span>);
<a name="l00590"></a>00590           source.append(<span class="stringliteral">&quot;  unsigned int col_index; \n&quot;</span>);
<a name="l00591"></a>00591           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; matrix_entry; \n&quot;</span>);
<a name="l00592"></a>00592           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00593"></a>00593           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = size; \n&quot;</span>);
<a name="l00594"></a>00594           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_end; \n&quot;</span>);
<a name="l00595"></a>00595           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = ( (nnz - 1) / get_local_size(0) + 1) * get_local_size(0); \n&quot;</span>);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597           source.append(<span class="stringliteral">&quot;  for (unsigned int i2 = get_local_id(0); i2 &lt; loop_end; i2 += get_local_size(0)) \n&quot;</span>);
<a name="l00598"></a>00598           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00599"></a>00599           source.append(<span class="stringliteral">&quot;    unsigned int i = (nnz - i2) - 1; \n&quot;</span>);
<a name="l00600"></a>00600           source.append(<span class="stringliteral">&quot;    col_index    = (i2 &lt; nnz) ? column_indices[i] : 0; \n&quot;</span>);
<a name="l00601"></a>00601           source.append(<span class="stringliteral">&quot;    matrix_entry = (i2 &lt; nnz) ? elements[i]       : 0; \n&quot;</span>);
<a name="l00602"></a>00602           source.append(<span class="stringliteral">&quot;    row_index_lookahead[get_local_id(0)] = (row_at_window_start &gt;= get_local_id(0)) ? row_indices[row_at_window_start - get_local_id(0)] : 0; \n&quot;</span>);
<a name="l00603"></a>00603 
<a name="l00604"></a>00604           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00605"></a>00605 
<a name="l00606"></a>00606           source.append(<span class="stringliteral">&quot;    if (i2 &lt; nnz) \n&quot;</span>);
<a name="l00607"></a>00607           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00608"></a>00608           source.append(<span class="stringliteral">&quot;      unsigned int row_index_dec = 0; \n&quot;</span>);
<a name="l00609"></a>00609           source.append(<span class="stringliteral">&quot;      while (row_index_lookahead[row_index_dec] &gt; i) \n&quot;</span>);
<a name="l00610"></a>00610           source.append(<span class="stringliteral">&quot;        ++row_index_dec; \n&quot;</span>);
<a name="l00611"></a>00611           source.append(<span class="stringliteral">&quot;      row_index = row_at_window_start - row_index_dec; \n&quot;</span>);
<a name="l00612"></a>00612           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = row_index; \n&quot;</span>);
<a name="l00613"></a>00613           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00614"></a>00614           source.append(<span class="stringliteral">&quot;    else \n&quot;</span>);
<a name="l00615"></a>00615           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00616"></a>00616           source.append(<span class="stringliteral">&quot;      row_index = size+1; \n&quot;</span>);
<a name="l00617"></a>00617           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = 0; \n&quot;</span>);
<a name="l00618"></a>00618           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00621"></a>00621 
<a name="l00622"></a>00622           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_index_buffer[0]; \n&quot;</span>);
<a name="l00623"></a>00623           source.append(<span class="stringliteral">&quot;    row_at_window_end   = row_index_buffer[get_local_size(0) - 1]; \n&quot;</span>);
<a name="l00624"></a>00624 
<a name="l00625"></a>00625               <span class="comment">//backward elimination</span>
<a name="l00626"></a>00626           source.append(<span class="stringliteral">&quot;    for (unsigned int row2 = 0; row2 &lt;= (row_at_window_start - row_at_window_end); ++row2) \n&quot;</span>);
<a name="l00627"></a>00627           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00628"></a>00628           source.append(<span class="stringliteral">&quot;      unsigned int row = row_at_window_start - row2; \n&quot;</span>);
<a name="l00629"></a>00629           source.append(<span class="stringliteral">&quot;      &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; result_entry = vector[row]; \n&quot;</span>);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631           source.append(<span class="stringliteral">&quot;      if ( (row_index == row) &amp;&amp; (col_index &lt; row) ) \n&quot;</span>);
<a name="l00632"></a>00632           source.append(<span class="stringliteral">&quot;        vector[col_index] -= result_entry * matrix_entry; \n&quot;</span>);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634           source.append(<span class="stringliteral">&quot;      barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00635"></a>00635           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00636"></a>00636 
<a name="l00637"></a>00637           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_at_window_end; \n&quot;</span>);
<a name="l00638"></a>00638           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00639"></a>00639           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00645"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a484c20211b507f40da7173d88594dd84">00645</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a484c20211b507f40da7173d88594dd84">generate_compressed_matrix_trans_unit_lu_forward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00646"></a>00646         {
<a name="l00647"></a>00647 
<a name="l00648"></a>00648           <span class="comment">// compute y in Ly = z for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00649"></a>00649           source.append(<span class="stringliteral">&quot;__kernel void trans_unit_lu_forward( \n&quot;</span>);
<a name="l00650"></a>00650           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00651"></a>00651           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00652"></a>00652           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00653"></a>00653           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00654"></a>00654           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00655"></a>00655           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00656"></a>00656           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_lookahead[256]; \n&quot;</span>);
<a name="l00657"></a>00657           source.append(<span class="stringliteral">&quot;  __local unsigned int row_index_buffer[256]; \n&quot;</span>);
<a name="l00658"></a>00658 
<a name="l00659"></a>00659           source.append(<span class="stringliteral">&quot;  unsigned int row_index; \n&quot;</span>);
<a name="l00660"></a>00660           source.append(<span class="stringliteral">&quot;  unsigned int col_index; \n&quot;</span>);
<a name="l00661"></a>00661           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; matrix_entry; \n&quot;</span>);
<a name="l00662"></a>00662           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00663"></a>00663           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = 0; \n&quot;</span>);
<a name="l00664"></a>00664           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_end = 0; \n&quot;</span>);
<a name="l00665"></a>00665           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = ( (nnz - 1) / get_local_size(0) + 1) * get_local_size(0); \n&quot;</span>);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667           source.append(<span class="stringliteral">&quot;  for (unsigned int i = get_local_id(0); i &lt; loop_end; i += get_local_size(0)) \n&quot;</span>);
<a name="l00668"></a>00668           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00669"></a>00669           source.append(<span class="stringliteral">&quot;    col_index    = (i &lt; nnz) ? column_indices[i] : 0; \n&quot;</span>);
<a name="l00670"></a>00670           source.append(<span class="stringliteral">&quot;    matrix_entry = (i &lt; nnz) ? elements[i]       : 0; \n&quot;</span>);
<a name="l00671"></a>00671           source.append(<span class="stringliteral">&quot;    row_index_lookahead[get_local_id(0)] = (row_at_window_start + get_local_id(0) &lt; size) ? row_indices[row_at_window_start + get_local_id(0)] : size - 1; \n&quot;</span>);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675           source.append(<span class="stringliteral">&quot;    if (i &lt; nnz) \n&quot;</span>);
<a name="l00676"></a>00676           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00677"></a>00677           source.append(<span class="stringliteral">&quot;      unsigned int row_index_inc = 0; \n&quot;</span>);
<a name="l00678"></a>00678           source.append(<span class="stringliteral">&quot;      while (i &gt;= row_index_lookahead[row_index_inc + 1]) \n&quot;</span>);
<a name="l00679"></a>00679           source.append(<span class="stringliteral">&quot;        ++row_index_inc; \n&quot;</span>);
<a name="l00680"></a>00680           source.append(<span class="stringliteral">&quot;      row_index = row_at_window_start + row_index_inc; \n&quot;</span>);
<a name="l00681"></a>00681           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = row_index; \n&quot;</span>);
<a name="l00682"></a>00682           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00683"></a>00683           source.append(<span class="stringliteral">&quot;    else \n&quot;</span>);
<a name="l00684"></a>00684           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00685"></a>00685           source.append(<span class="stringliteral">&quot;      row_index = size+1; \n&quot;</span>);
<a name="l00686"></a>00686           source.append(<span class="stringliteral">&quot;      row_index_buffer[get_local_id(0)] = size - 1; \n&quot;</span>);
<a name="l00687"></a>00687           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00688"></a>00688 
<a name="l00689"></a>00689           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00690"></a>00690 
<a name="l00691"></a>00691           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_index_buffer[0]; \n&quot;</span>);
<a name="l00692"></a>00692           source.append(<span class="stringliteral">&quot;    row_at_window_end   = row_index_buffer[get_local_size(0) - 1]; \n&quot;</span>);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694               <span class="comment">//forward elimination</span>
<a name="l00695"></a>00695           source.append(<span class="stringliteral">&quot;    for (unsigned int row = row_at_window_start; row &lt;= row_at_window_end; ++row) \n&quot;</span>);
<a name="l00696"></a>00696           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00697"></a>00697           source.append(<span class="stringliteral">&quot;      &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; result_entry = vector[row]; \n&quot;</span>);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699           source.append(<span class="stringliteral">&quot;      if ( (row_index == row) &amp;&amp; (col_index &gt; row) ) \n&quot;</span>);
<a name="l00700"></a>00700           source.append(<span class="stringliteral">&quot;        vector[col_index] -= result_entry * matrix_entry; \n&quot;</span>);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702           source.append(<span class="stringliteral">&quot;      barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00703"></a>00703           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705           source.append(<span class="stringliteral">&quot;    row_at_window_start = row_at_window_end; \n&quot;</span>);
<a name="l00706"></a>00706           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00707"></a>00707           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00712"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#ab9954c11d62e4105cc57845d0b3f014c">00712</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#ab9954c11d62e4105cc57845d0b3f014c">generate_compressed_matrix_trans_unit_lu_forward_slow</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00713"></a>00713         {
<a name="l00714"></a>00714 
<a name="l00715"></a>00715           <span class="comment">// compute y in Ly = z for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00716"></a>00716           source.append(<span class="stringliteral">&quot;__kernel void trans_unit_lu_forward_slow( \n&quot;</span>);
<a name="l00717"></a>00717           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00718"></a>00718           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00719"></a>00719           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00720"></a>00720           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00721"></a>00721           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00722"></a>00722           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00723"></a>00723           source.append(<span class="stringliteral">&quot;  for (unsigned int row = 0; row &lt; size; ++row) \n&quot;</span>);
<a name="l00724"></a>00724           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00725"></a>00725           source.append(<span class="stringliteral">&quot;    &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; result_entry = vector[row]; \n&quot;</span>);
<a name="l00726"></a>00726 
<a name="l00727"></a>00727           source.append(<span class="stringliteral">&quot;    unsigned int row_start = row_indices[row]; \n&quot;</span>);
<a name="l00728"></a>00728           source.append(<span class="stringliteral">&quot;    unsigned int row_stop  = row_indices[row + 1]; \n&quot;</span>);
<a name="l00729"></a>00729           source.append(<span class="stringliteral">&quot;    for (unsigned int entry_index = row_start + get_local_id(0); entry_index &lt; row_stop; entry_index += get_local_size(0)) \n&quot;</span>);
<a name="l00730"></a>00730           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00731"></a>00731           source.append(<span class="stringliteral">&quot;      unsigned int col_index = column_indices[entry_index]; \n&quot;</span>);
<a name="l00732"></a>00732           source.append(<span class="stringliteral">&quot;      if (col_index &gt; row) \n&quot;</span>);
<a name="l00733"></a>00733           source.append(<span class="stringliteral">&quot;        vector[col_index] -= result_entry * elements[entry_index]; \n&quot;</span>);
<a name="l00734"></a>00734           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736           source.append(<span class="stringliteral">&quot;    barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00737"></a>00737           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00738"></a>00738           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00739"></a>00739 
<a name="l00740"></a>00740         }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00743"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a836d0520b1c9ea87cae0450de034ba4b">00743</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a836d0520b1c9ea87cae0450de034ba4b">generate_compressed_matrix_unit_lu_backward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00744"></a>00744         {
<a name="l00745"></a>00745 
<a name="l00746"></a>00746           <span class="comment">// compute x in Ux = y for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00747"></a>00747           source.append(<span class="stringliteral">&quot;__kernel void unit_lu_backward( \n&quot;</span>);
<a name="l00748"></a>00748           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00749"></a>00749           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00750"></a>00750           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00751"></a>00751           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00752"></a>00752           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00753"></a>00753           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00754"></a>00754           source.append(<span class="stringliteral">&quot;  __local  unsigned int col_index_buffer[128]; \n&quot;</span>);
<a name="l00755"></a>00755           source.append(<span class="stringliteral">&quot;  __local  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; element_buffer[128]; \n&quot;</span>);
<a name="l00756"></a>00756           source.append(<span class="stringliteral">&quot;  __local  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; vector_buffer[128]; \n&quot;</span>);
<a name="l00757"></a>00757 
<a name="l00758"></a>00758           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00759"></a>00759           source.append(<span class="stringliteral">&quot;  unsigned int current_row = size-1; \n&quot;</span>);
<a name="l00760"></a>00760           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = size-1; \n&quot;</span>);
<a name="l00761"></a>00761           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; current_vector_entry = vector[size-1]; \n&quot;</span>);
<a name="l00762"></a>00762           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = ( (nnz - 1) / get_local_size(0)) * get_local_size(0); \n&quot;</span>);
<a name="l00763"></a>00763           source.append(<span class="stringliteral">&quot;  unsigned int next_row = row_indices[size-1]; \n&quot;</span>);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765           source.append(<span class="stringliteral">&quot;  unsigned int i = loop_end + get_local_id(0); \n&quot;</span>);
<a name="l00766"></a>00766           source.append(<span class="stringliteral">&quot;  while (1) \n&quot;</span>);
<a name="l00767"></a>00767           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00768"></a>00768               <span class="comment">//load into shared memory (coalesced access):</span>
<a name="l00769"></a>00769           source.append(<span class="stringliteral">&quot;    if (i &lt; nnz) \n&quot;</span>);
<a name="l00770"></a>00770           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00771"></a>00771           source.append(<span class="stringliteral">&quot;      element_buffer[get_local_id(0)] = elements[i]; \n&quot;</span>);
<a name="l00772"></a>00772           source.append(<span class="stringliteral">&quot;      unsigned int tmp = column_indices[i]; \n&quot;</span>);
<a name="l00773"></a>00773           source.append(<span class="stringliteral">&quot;      col_index_buffer[get_local_id(0)] = tmp; \n&quot;</span>);
<a name="l00774"></a>00774           source.append(<span class="stringliteral">&quot;      vector_buffer[get_local_id(0)] = vector[tmp]; \n&quot;</span>);
<a name="l00775"></a>00775           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00776"></a>00776 
<a name="l00777"></a>00777           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779               <span class="comment">//now a single thread does the remaining work in shared memory:</span>
<a name="l00780"></a>00780           source.append(<span class="stringliteral">&quot;    if (get_local_id(0) == 0) \n&quot;</span>);
<a name="l00781"></a>00781           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00782"></a>00782               <span class="comment">// traverse through all the loaded data from back to front:</span>
<a name="l00783"></a>00783           source.append(<span class="stringliteral">&quot;      for (unsigned int k2=0; k2&lt;get_local_size(0); ++k2) \n&quot;</span>);
<a name="l00784"></a>00784           source.append(<span class="stringliteral">&quot;      { \n&quot;</span>);
<a name="l00785"></a>00785           source.append(<span class="stringliteral">&quot;        unsigned int k = (get_local_size(0) - k2) - 1; \n&quot;</span>);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787           source.append(<span class="stringliteral">&quot;        if (i+k &gt;= nnz) \n&quot;</span>);
<a name="l00788"></a>00788           source.append(<span class="stringliteral">&quot;          continue; \n&quot;</span>);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790           source.append(<span class="stringliteral">&quot;        if (col_index_buffer[k] &gt; row_at_window_start) \n&quot;</span>); <span class="comment">//use recently computed results</span>
<a name="l00791"></a>00791           source.append(<span class="stringliteral">&quot;          current_vector_entry -= element_buffer[k] * vector_buffer[k]; \n&quot;</span>);
<a name="l00792"></a>00792           source.append(<span class="stringliteral">&quot;        else if (col_index_buffer[k] &gt; current_row) \n&quot;</span>); <span class="comment">//use buffered data</span>
<a name="l00793"></a>00793           source.append(<span class="stringliteral">&quot;          current_vector_entry -= element_buffer[k] * vector[col_index_buffer[k]]; \n&quot;</span>);
<a name="l00794"></a>00794 
<a name="l00795"></a>00795           source.append(<span class="stringliteral">&quot;        if (i+k == next_row) \n&quot;</span>); <span class="comment">//current row is finished. Write back result</span>
<a name="l00796"></a>00796           source.append(<span class="stringliteral">&quot;        { \n&quot;</span>);
<a name="l00797"></a>00797           source.append(<span class="stringliteral">&quot;          vector[current_row] = current_vector_entry; \n&quot;</span>);
<a name="l00798"></a>00798           source.append(<span class="stringliteral">&quot;          if (current_row &gt; 0) \n&quot;</span>); <span class="comment">//load next row&#39;s data</span>
<a name="l00799"></a>00799           source.append(<span class="stringliteral">&quot;          { \n&quot;</span>);
<a name="l00800"></a>00800           source.append(<span class="stringliteral">&quot;            --current_row; \n&quot;</span>);
<a name="l00801"></a>00801           source.append(<span class="stringliteral">&quot;            next_row = row_indices[current_row]; \n&quot;</span>);
<a name="l00802"></a>00802           source.append(<span class="stringliteral">&quot;            current_vector_entry = vector[current_row]; \n&quot;</span>);
<a name="l00803"></a>00803           source.append(<span class="stringliteral">&quot;          } \n&quot;</span>);
<a name="l00804"></a>00804           source.append(<span class="stringliteral">&quot;        } \n&quot;</span>);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806 
<a name="l00807"></a>00807           source.append(<span class="stringliteral">&quot;      } \n&quot;</span>); <span class="comment">// for k</span>
<a name="l00808"></a>00808 
<a name="l00809"></a>00809           source.append(<span class="stringliteral">&quot;      row_at_window_start = current_row; \n&quot;</span>);
<a name="l00810"></a>00810           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>); <span class="comment">// if (get_local_id(0) == 0)</span>
<a name="l00811"></a>00811 
<a name="l00812"></a>00812           source.append(<span class="stringliteral">&quot;    barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00813"></a>00813 
<a name="l00814"></a>00814           source.append(<span class="stringliteral">&quot;    if (i &lt; get_local_size(0)) \n&quot;</span>);
<a name="l00815"></a>00815           source.append(<span class="stringliteral">&quot;      break; \n&quot;</span>);
<a name="l00816"></a>00816 
<a name="l00817"></a>00817           source.append(<span class="stringliteral">&quot;    i -= get_local_size(0); \n&quot;</span>);
<a name="l00818"></a>00818           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>); <span class="comment">//for i</span>
<a name="l00819"></a>00819           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00820"></a>00820 
<a name="l00821"></a>00821         }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00824"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a7e526af2727d59e925c23996b48ef0a6">00824</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a7e526af2727d59e925c23996b48ef0a6">generate_compressed_matrix_unit_lu_forward</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00825"></a>00825         {
<a name="l00826"></a>00826 
<a name="l00827"></a>00827           <span class="comment">// compute y in Ly = z for incomplete LU factorizations of a sparse matrix in compressed format</span>
<a name="l00828"></a>00828           source.append(<span class="stringliteral">&quot;__kernel void unit_lu_forward( \n&quot;</span>);
<a name="l00829"></a>00829           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00830"></a>00830           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00831"></a>00831           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00832"></a>00832           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l00833"></a>00833           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l00834"></a>00834           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00835"></a>00835           source.append(<span class="stringliteral">&quot;  __local  unsigned int col_index_buffer[128]; \n&quot;</span>);
<a name="l00836"></a>00836           source.append(<span class="stringliteral">&quot;  __local  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; element_buffer[128]; \n&quot;</span>);
<a name="l00837"></a>00837           source.append(<span class="stringliteral">&quot;  __local  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; vector_buffer[128]; \n&quot;</span>);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839           source.append(<span class="stringliteral">&quot;  unsigned int nnz = row_indices[size]; \n&quot;</span>);
<a name="l00840"></a>00840           source.append(<span class="stringliteral">&quot;  unsigned int current_row = 0; \n&quot;</span>);
<a name="l00841"></a>00841           source.append(<span class="stringliteral">&quot;  unsigned int row_at_window_start = 0; \n&quot;</span>);
<a name="l00842"></a>00842           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; current_vector_entry = vector[0]; \n&quot;</span>);
<a name="l00843"></a>00843           source.append(<span class="stringliteral">&quot;  unsigned int loop_end = (nnz / get_local_size(0) + 1) * get_local_size(0); \n&quot;</span>);
<a name="l00844"></a>00844           source.append(<span class="stringliteral">&quot;  unsigned int next_row = row_indices[1]; \n&quot;</span>);
<a name="l00845"></a>00845 
<a name="l00846"></a>00846           source.append(<span class="stringliteral">&quot;  for (unsigned int i = get_local_id(0); i &lt; loop_end; i += get_local_size(0)) \n&quot;</span>);
<a name="l00847"></a>00847           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00848"></a>00848               <span class="comment">//load into shared memory (coalesced access):</span>
<a name="l00849"></a>00849           source.append(<span class="stringliteral">&quot;    if (i &lt; nnz) \n&quot;</span>);
<a name="l00850"></a>00850           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00851"></a>00851           source.append(<span class="stringliteral">&quot;      element_buffer[get_local_id(0)] = elements[i]; \n&quot;</span>);
<a name="l00852"></a>00852           source.append(<span class="stringliteral">&quot;      unsigned int tmp = column_indices[i]; \n&quot;</span>);
<a name="l00853"></a>00853           source.append(<span class="stringliteral">&quot;      col_index_buffer[get_local_id(0)] = tmp; \n&quot;</span>);
<a name="l00854"></a>00854           source.append(<span class="stringliteral">&quot;      vector_buffer[get_local_id(0)] = vector[tmp]; \n&quot;</span>);
<a name="l00855"></a>00855           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00856"></a>00856 
<a name="l00857"></a>00857           source.append(<span class="stringliteral">&quot;    barrier(CLK_LOCAL_MEM_FENCE); \n&quot;</span>);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859               <span class="comment">//now a single thread does the remaining work in shared memory:</span>
<a name="l00860"></a>00860           source.append(<span class="stringliteral">&quot;    if (get_local_id(0) == 0) \n&quot;</span>);
<a name="l00861"></a>00861           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00862"></a>00862                 <span class="comment">// traverse through all the loaded data:</span>
<a name="l00863"></a>00863           source.append(<span class="stringliteral">&quot;      for (unsigned int k=0; k&lt;get_local_size(0); ++k) \n&quot;</span>);
<a name="l00864"></a>00864           source.append(<span class="stringliteral">&quot;      { \n&quot;</span>);
<a name="l00865"></a>00865           source.append(<span class="stringliteral">&quot;        if (i+k == next_row) \n&quot;</span>); <span class="comment">//current row is finished. Write back result</span>
<a name="l00866"></a>00866           source.append(<span class="stringliteral">&quot;        { \n&quot;</span>);
<a name="l00867"></a>00867           source.append(<span class="stringliteral">&quot;          vector[current_row] = current_vector_entry; \n&quot;</span>);
<a name="l00868"></a>00868           source.append(<span class="stringliteral">&quot;          ++current_row; \n&quot;</span>);
<a name="l00869"></a>00869           source.append(<span class="stringliteral">&quot;          if (current_row &lt; size) //load next row&#39;s data \n&quot;</span>);
<a name="l00870"></a>00870           source.append(<span class="stringliteral">&quot;          { \n&quot;</span>);
<a name="l00871"></a>00871           source.append(<span class="stringliteral">&quot;            next_row = row_indices[current_row+1]; \n&quot;</span>);
<a name="l00872"></a>00872           source.append(<span class="stringliteral">&quot;            current_vector_entry = vector[current_row]; \n&quot;</span>);
<a name="l00873"></a>00873           source.append(<span class="stringliteral">&quot;          } \n&quot;</span>);
<a name="l00874"></a>00874           source.append(<span class="stringliteral">&quot;        } \n&quot;</span>);
<a name="l00875"></a>00875 
<a name="l00876"></a>00876           source.append(<span class="stringliteral">&quot;        if (current_row &lt; size &amp;&amp; col_index_buffer[k] &lt; current_row) \n&quot;</span>); <span class="comment">//substitute</span>
<a name="l00877"></a>00877           source.append(<span class="stringliteral">&quot;        { \n&quot;</span>);
<a name="l00878"></a>00878           source.append(<span class="stringliteral">&quot;          if (col_index_buffer[k] &lt; row_at_window_start) \n&quot;</span>); <span class="comment">//use recently computed results</span>
<a name="l00879"></a>00879           source.append(<span class="stringliteral">&quot;            current_vector_entry -= element_buffer[k] * vector_buffer[k]; \n&quot;</span>);
<a name="l00880"></a>00880           source.append(<span class="stringliteral">&quot;          else if (col_index_buffer[k] &lt; current_row) \n&quot;</span>); <span class="comment">//use buffered data</span>
<a name="l00881"></a>00881           source.append(<span class="stringliteral">&quot;            current_vector_entry -= element_buffer[k] * vector[col_index_buffer[k]]; \n&quot;</span>);
<a name="l00882"></a>00882           source.append(<span class="stringliteral">&quot;        } \n&quot;</span>);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884           source.append(<span class="stringliteral">&quot;      } \n&quot;</span>); <span class="comment">// for k</span>
<a name="l00885"></a>00885 
<a name="l00886"></a>00886           source.append(<span class="stringliteral">&quot;      row_at_window_start = current_row; \n&quot;</span>);
<a name="l00887"></a>00887           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>); <span class="comment">// if (get_local_id(0) == 0)</span>
<a name="l00888"></a>00888 
<a name="l00889"></a>00889           source.append(<span class="stringliteral">&quot;    barrier(CLK_GLOBAL_MEM_FENCE); \n&quot;</span>);
<a name="l00890"></a>00890           source.append(<span class="stringliteral">&quot;  } //for i \n&quot;</span>);
<a name="l00891"></a>00891           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00892"></a>00892 
<a name="l00893"></a>00893         }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00896"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a76a7d90884ad785f48b0c957a8fa31a3">00896</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a76a7d90884ad785f48b0c957a8fa31a3">generate_compressed_matrix_vec_mul</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00897"></a>00897         {
<a name="l00898"></a>00898 
<a name="l00899"></a>00899           source.append(<span class="stringliteral">&quot;__kernel void vec_mul( \n&quot;</span>);
<a name="l00900"></a>00900           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00901"></a>00901           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l00902"></a>00902           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l00903"></a>00903           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * x, \n&quot;</span>);
<a name="l00904"></a>00904           source.append(<span class="stringliteral">&quot;          uint4 layout_x, \n&quot;</span>);
<a name="l00905"></a>00905           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l00906"></a>00906           source.append(<span class="stringliteral">&quot;          uint4 layout_result) \n&quot;</span>);
<a name="l00907"></a>00907           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00908"></a>00908           source.append(<span class="stringliteral">&quot;  for (unsigned int row = get_global_id(0); row &lt; layout_result.z; row += get_global_size(0)) \n&quot;</span>);
<a name="l00909"></a>00909           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00910"></a>00910           source.append(<span class="stringliteral">&quot;    &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; dot_prod = 0; \n&quot;</span>);
<a name="l00911"></a>00911           source.append(<span class="stringliteral">&quot;    unsigned int row_end = row_indices[row+1]; \n&quot;</span>);
<a name="l00912"></a>00912           source.append(<span class="stringliteral">&quot;    for (unsigned int i = row_indices[row]; i &lt; row_end; ++i) \n&quot;</span>);
<a name="l00913"></a>00913           source.append(<span class="stringliteral">&quot;      dot_prod += elements[i] * x[column_indices[i] * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00914"></a>00914           source.append(<span class="stringliteral">&quot;    result[row * layout_result.y + layout_result.x] = dot_prod; \n&quot;</span>);
<a name="l00915"></a>00915           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00916"></a>00916           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00917"></a>00917 
<a name="l00918"></a>00918         }
<a name="l00919"></a>00919 
<a name="l00920"></a>00920         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00921"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a68f00e6161b75c39a5b0fe467a8f7197">00921</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a68f00e6161b75c39a5b0fe467a8f7197">generate_compressed_matrix_vec_mul4</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00922"></a>00922         {
<a name="l00923"></a>00923           source.append(<span class="stringliteral">&quot;__kernel void vec_mul4( \n&quot;</span>);
<a name="l00924"></a>00924           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00925"></a>00925           source.append(<span class="stringliteral">&quot;          __global const uint4 * column_indices, \n&quot;</span>);
<a name="l00926"></a>00926           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot;4 * elements, \n&quot;</span>);
<a name="l00927"></a>00927           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * x, \n&quot;</span>);
<a name="l00928"></a>00928           source.append(<span class="stringliteral">&quot;          uint4 layout_x, \n&quot;</span>);
<a name="l00929"></a>00929           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l00930"></a>00930           source.append(<span class="stringliteral">&quot;          uint4 layout_result) \n&quot;</span>);
<a name="l00931"></a>00931           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00932"></a>00932           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; dot_prod; \n&quot;</span>);
<a name="l00933"></a>00933           source.append(<span class="stringliteral">&quot;  unsigned int start, next_stop; \n&quot;</span>);
<a name="l00934"></a>00934           source.append(<span class="stringliteral">&quot;  uint4 col_idx; \n&quot;</span>);
<a name="l00935"></a>00935           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot;4 tmp_vec; \n&quot;</span>);
<a name="l00936"></a>00936           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot;4 tmp_entries; \n&quot;</span>);
<a name="l00937"></a>00937 
<a name="l00938"></a>00938           source.append(<span class="stringliteral">&quot;  for (unsigned int row = get_global_id(0); row &lt; layout_result.z; row += get_global_size(0)) \n&quot;</span>);
<a name="l00939"></a>00939           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00940"></a>00940           source.append(<span class="stringliteral">&quot;    dot_prod = 0; \n&quot;</span>);
<a name="l00941"></a>00941           source.append(<span class="stringliteral">&quot;    start = row_indices[row] / 4; \n&quot;</span>);
<a name="l00942"></a>00942           source.append(<span class="stringliteral">&quot;    next_stop = row_indices[row+1] / 4; \n&quot;</span>);
<a name="l00943"></a>00943 
<a name="l00944"></a>00944           source.append(<span class="stringliteral">&quot;    for (unsigned int i = start; i &lt; next_stop; ++i) \n&quot;</span>);
<a name="l00945"></a>00945           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00946"></a>00946           source.append(<span class="stringliteral">&quot;      col_idx = column_indices[i]; \n&quot;</span>);
<a name="l00947"></a>00947 
<a name="l00948"></a>00948           source.append(<span class="stringliteral">&quot;      tmp_entries = elements[i]; \n&quot;</span>);
<a name="l00949"></a>00949           source.append(<span class="stringliteral">&quot;      tmp_vec.x = x[col_idx.x * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00950"></a>00950           source.append(<span class="stringliteral">&quot;      tmp_vec.y = x[col_idx.y * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00951"></a>00951           source.append(<span class="stringliteral">&quot;      tmp_vec.z = x[col_idx.z * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00952"></a>00952           source.append(<span class="stringliteral">&quot;      tmp_vec.w = x[col_idx.w * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954           source.append(<span class="stringliteral">&quot;      dot_prod += dot(tmp_entries, tmp_vec); \n&quot;</span>);
<a name="l00955"></a>00955           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l00956"></a>00956           source.append(<span class="stringliteral">&quot;    result[row * layout_result.y + layout_result.x] = dot_prod; \n&quot;</span>);
<a name="l00957"></a>00957           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l00958"></a>00958           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l00959"></a>00959         }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l00962"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a53ccc778ba6a11741e679311c49f2c96">00962</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a53ccc778ba6a11741e679311c49f2c96">generate_compressed_matrix_vec_mul8</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l00963"></a>00963         {
<a name="l00964"></a>00964           source.append(<span class="stringliteral">&quot;__kernel void vec_mul8( \n&quot;</span>);
<a name="l00965"></a>00965           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l00966"></a>00966           source.append(<span class="stringliteral">&quot;          __global const uint8 * column_indices, \n&quot;</span>);
<a name="l00967"></a>00967           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot;8 * elements, \n&quot;</span>);
<a name="l00968"></a>00968           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * x, \n&quot;</span>);
<a name="l00969"></a>00969           source.append(<span class="stringliteral">&quot;          uint4 layout_x, \n&quot;</span>);
<a name="l00970"></a>00970           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l00971"></a>00971           source.append(<span class="stringliteral">&quot;          uint4 layout_result) \n&quot;</span>);
<a name="l00972"></a>00972           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l00973"></a>00973           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; dot_prod; \n&quot;</span>);
<a name="l00974"></a>00974           source.append(<span class="stringliteral">&quot;  unsigned int start, next_stop; \n&quot;</span>);
<a name="l00975"></a>00975           source.append(<span class="stringliteral">&quot;  uint8 col_idx; \n&quot;</span>);
<a name="l00976"></a>00976           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot;8 tmp_vec; \n&quot;</span>);
<a name="l00977"></a>00977           source.append(<span class="stringliteral">&quot;  &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot;8 tmp_entries; \n&quot;</span>);
<a name="l00978"></a>00978 
<a name="l00979"></a>00979           source.append(<span class="stringliteral">&quot;  for (unsigned int row = get_global_id(0); row &lt; layout_result.z; row += get_global_size(0)) \n&quot;</span>);
<a name="l00980"></a>00980           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l00981"></a>00981           source.append(<span class="stringliteral">&quot;    dot_prod = 0; \n&quot;</span>);
<a name="l00982"></a>00982           source.append(<span class="stringliteral">&quot;    start = row_indices[row] / 8; \n&quot;</span>);
<a name="l00983"></a>00983           source.append(<span class="stringliteral">&quot;    next_stop = row_indices[row+1] / 8; \n&quot;</span>);
<a name="l00984"></a>00984 
<a name="l00985"></a>00985           source.append(<span class="stringliteral">&quot;    for (unsigned int i = start; i &lt; next_stop; ++i) \n&quot;</span>);
<a name="l00986"></a>00986           source.append(<span class="stringliteral">&quot;    { \n&quot;</span>);
<a name="l00987"></a>00987           source.append(<span class="stringliteral">&quot;      col_idx = column_indices[i]; \n&quot;</span>);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989           source.append(<span class="stringliteral">&quot;      tmp_entries = elements[i]; \n&quot;</span>);
<a name="l00990"></a>00990           source.append(<span class="stringliteral">&quot;      tmp_vec.s0 = x[col_idx.s0 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00991"></a>00991           source.append(<span class="stringliteral">&quot;      tmp_vec.s1 = x[col_idx.s1 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00992"></a>00992           source.append(<span class="stringliteral">&quot;      tmp_vec.s2 = x[col_idx.s2 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00993"></a>00993           source.append(<span class="stringliteral">&quot;      tmp_vec.s3 = x[col_idx.s3 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00994"></a>00994           source.append(<span class="stringliteral">&quot;      tmp_vec.s4 = x[col_idx.s4 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00995"></a>00995           source.append(<span class="stringliteral">&quot;      tmp_vec.s5 = x[col_idx.s5 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00996"></a>00996           source.append(<span class="stringliteral">&quot;      tmp_vec.s6 = x[col_idx.s6 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00997"></a>00997           source.append(<span class="stringliteral">&quot;      tmp_vec.s7 = x[col_idx.s7 * layout_x.y + layout_x.x]; \n&quot;</span>);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999           source.append(<span class="stringliteral">&quot;      dot_prod += dot(tmp_entries.lo, tmp_vec.lo); \n&quot;</span>);
<a name="l01000"></a>01000           source.append(<span class="stringliteral">&quot;      dot_prod += dot(tmp_entries.hi, tmp_vec.hi); \n&quot;</span>);
<a name="l01001"></a>01001           source.append(<span class="stringliteral">&quot;    } \n&quot;</span>);
<a name="l01002"></a>01002           source.append(<span class="stringliteral">&quot;    result[row * layout_result.y + layout_result.x] = dot_prod; \n&quot;</span>);
<a name="l01003"></a>01003           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l01004"></a>01004           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l01005"></a>01005         }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> StringType&gt;
<a name="l01008"></a><a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a4b93c996bb01d31bf70d104779cc4282">01008</a>         <span class="keywordtype">void</span> <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a4b93c996bb01d31bf70d104779cc4282">generate_compressed_matrix_vec_mul_cpu</a>(StringType &amp; source, std::string <span class="keyword">const</span> &amp; numeric_string)
<a name="l01009"></a>01009         {
<a name="l01010"></a>01010           source.append(<span class="stringliteral">&quot;__kernel void vec_mul_cpu( \n&quot;</span>);
<a name="l01011"></a>01011           source.append(<span class="stringliteral">&quot;          __global const unsigned int * row_indices, \n&quot;</span>);
<a name="l01012"></a>01012           source.append(<span class="stringliteral">&quot;          __global const unsigned int * column_indices, \n&quot;</span>);
<a name="l01013"></a>01013           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * elements, \n&quot;</span>);
<a name="l01014"></a>01014           source.append(<span class="stringliteral">&quot;          __global const &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * vector, \n&quot;</span>);
<a name="l01015"></a>01015           source.append(<span class="stringliteral">&quot;          __global &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; * result, \n&quot;</span>);
<a name="l01016"></a>01016           source.append(<span class="stringliteral">&quot;          unsigned int size) \n&quot;</span>);
<a name="l01017"></a>01017           source.append(<span class="stringliteral">&quot;{ \n&quot;</span>);
<a name="l01018"></a>01018           source.append(<span class="stringliteral">&quot;  unsigned int work_per_item = max((uint) (size / get_global_size(0)), (uint) 1); \n&quot;</span>);
<a name="l01019"></a>01019           source.append(<span class="stringliteral">&quot;  unsigned int row_start = get_global_id(0) * work_per_item; \n&quot;</span>);
<a name="l01020"></a>01020           source.append(<span class="stringliteral">&quot;  unsigned int row_stop  = min( (uint) ((get_global_id(0) + 1) * work_per_item), (uint) size); \n&quot;</span>);
<a name="l01021"></a>01021           source.append(<span class="stringliteral">&quot;  for (unsigned int row = row_start; row &lt; row_stop; ++row) \n&quot;</span>);
<a name="l01022"></a>01022           source.append(<span class="stringliteral">&quot;  { \n&quot;</span>);
<a name="l01023"></a>01023           source.append(<span class="stringliteral">&quot;    &quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot; dot_prod = (&quot;</span>); source.append(numeric_string); source.append(<span class="stringliteral">&quot;)0; \n&quot;</span>);
<a name="l01024"></a>01024           source.append(<span class="stringliteral">&quot;    unsigned int row_end = row_indices[row+1]; \n&quot;</span>);
<a name="l01025"></a>01025           source.append(<span class="stringliteral">&quot;    for (unsigned int i = row_indices[row]; i &lt; row_end; ++i) \n&quot;</span>);
<a name="l01026"></a>01026           source.append(<span class="stringliteral">&quot;      dot_prod += elements[i] * vector[column_indices[i]]; \n&quot;</span>);
<a name="l01027"></a>01027           source.append(<span class="stringliteral">&quot;    result[row] = dot_prod; \n&quot;</span>);
<a name="l01028"></a>01028           source.append(<span class="stringliteral">&quot;  } \n&quot;</span>);
<a name="l01029"></a>01029           source.append(<span class="stringliteral">&quot;} \n&quot;</span>);
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033 
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         <span class="comment">// main kernel class</span>
<a name="l01038"></a>01038 <span class="comment"></span>        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> NumericT&gt;
<a name="l01039"></a><a class="code" href="structviennacl_1_1linalg_1_1opencl_1_1kernels_1_1compressed__matrix.html">01039</a>         <span class="keyword">struct </span><a class="code" href="structviennacl_1_1linalg_1_1opencl_1_1kernels_1_1compressed__matrix.html" title="Main kernel class for generating OpenCL kernels for compressed_matrix.">compressed_matrix</a>
<a name="l01040"></a>01040         {
<a name="l01041"></a><a class="code" href="structviennacl_1_1linalg_1_1opencl_1_1kernels_1_1compressed__matrix.html#adb4613919bae5cf962e40b99da83dd96">01041</a>           <span class="keyword">static</span> std::string <a class="code" href="structviennacl_1_1linalg_1_1opencl_1_1kernels_1_1compressed__matrix.html#adb4613919bae5cf962e40b99da83dd96">program_name</a>()
<a name="l01042"></a>01042           {
<a name="l01043"></a>01043             <span class="keywordflow">return</span> viennacl::ocl::type_to_string&lt;NumericT&gt;::apply() + <span class="stringliteral">&quot;_compressed_matrix&quot;</span>;
<a name="l01044"></a>01044           }
<a name="l01045"></a>01045 
<a name="l01046"></a><a class="code" href="structviennacl_1_1linalg_1_1opencl_1_1kernels_1_1compressed__matrix.html#a221d941d15df6a926cc0af6301187e6f">01046</a>           <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structviennacl_1_1linalg_1_1opencl_1_1kernels_1_1compressed__matrix.html#a221d941d15df6a926cc0af6301187e6f">init</a>(<a class="code" href="classviennacl_1_1ocl_1_1context.html" title="Manages an OpenCL context and provides the respective convenience functions for creating buffers...">viennacl::ocl::context</a> &amp; ctx)
<a name="l01047"></a>01047           {
<a name="l01048"></a>01048             <a class="code" href="structviennacl_1_1ocl_1_1_d_o_u_b_l_e___p_r_e_c_i_s_i_o_n___c_h_e_c_k_e_r.html" title="Ensures that double precision types are only allocated if it is supported by the device. If double precision is requested for a device not capable of providing that, a double_precision_not_provided_error is thrown.">viennacl::ocl::DOUBLE_PRECISION_CHECKER&lt;NumericT&gt;::apply</a>(ctx);
<a name="l01049"></a>01049             std::string numeric_string = viennacl::ocl::type_to_string&lt;NumericT&gt;::apply();
<a name="l01050"></a>01050 
<a name="l01051"></a>01051             <span class="keyword">static</span> std::map&lt;cl_context, bool&gt; init_done;
<a name="l01052"></a>01052             <span class="keywordflow">if</span> (!init_done[ctx.<a class="code" href="classviennacl_1_1ocl_1_1context.html#a04a2acfc068529af42d1772382a20b90" title="Returns the context handle.">handle</a>().<a class="code" href="classviennacl_1_1ocl_1_1handle.html#a0f432d9c11ccab11ef350affd8791e47">get</a>()])
<a name="l01053"></a>01053             {
<a name="l01054"></a>01054               std::string source;
<a name="l01055"></a>01055               source.reserve(1024);
<a name="l01056"></a>01056 
<a name="l01057"></a>01057               viennacl::ocl::append_double_precision_pragma&lt;NumericT&gt;(ctx, source);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059               <span class="keywordflow">if</span> (numeric_string == <span class="stringliteral">&quot;float&quot;</span> || numeric_string == <span class="stringliteral">&quot;double&quot;</span>)
<a name="l01060"></a>01060               {
<a name="l01061"></a>01061                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#ae034a9ae2635e47824917a3175495957">generate_compressed_matrix_block_trans_lu_backward</a>(source, numeric_string);
<a name="l01062"></a>01062                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#af303cc8927bc3574bd29e0bdae342b01">generate_compressed_matrix_block_trans_unit_lu_forward</a>(source, numeric_string);
<a name="l01063"></a>01063                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#af568d2205ae5ee359991aaf0020e79e9">generate_compressed_matrix_jacobi</a>(source, numeric_string);
<a name="l01064"></a>01064                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#aaaaa136ff06f88b86de6e5fc910414fb">generate_compressed_matrix_lu_backward</a>(source, numeric_string);
<a name="l01065"></a>01065                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a332482e35049c0e2e0d878e07ca4b12d">generate_compressed_matrix_lu_forward</a>(source, numeric_string);
<a name="l01066"></a>01066                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a67279282d74a5e13f77e1c494867a468">generate_compressed_matrix_trans_lu_backward</a>(source, numeric_string);
<a name="l01067"></a>01067                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a3d3316ebcdccea8c7c4392d4f3114aac">generate_compressed_matrix_trans_lu_forward</a>(source, numeric_string);
<a name="l01068"></a>01068                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a9be305cd62f71c5d09f20d50fc14857a">generate_compressed_matrix_trans_unit_lu_backward</a>(source, numeric_string);
<a name="l01069"></a>01069                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a484c20211b507f40da7173d88594dd84">generate_compressed_matrix_trans_unit_lu_forward</a>(source, numeric_string);
<a name="l01070"></a>01070                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#ab9954c11d62e4105cc57845d0b3f014c">generate_compressed_matrix_trans_unit_lu_forward_slow</a>(source, numeric_string);
<a name="l01071"></a>01071                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a836d0520b1c9ea87cae0450de034ba4b">generate_compressed_matrix_unit_lu_backward</a>(source, numeric_string);
<a name="l01072"></a>01072                 <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a7e526af2727d59e925c23996b48ef0a6">generate_compressed_matrix_unit_lu_forward</a>(source, numeric_string);
<a name="l01073"></a>01073               }
<a name="l01074"></a>01074               <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a2e6ec11f4c700faff4c4038360582dc7">generate_compressed_matrix_dense_matrix_multiplication</a>(source, numeric_string);
<a name="l01075"></a>01075               <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a8c315bc961b2baa1779751171fd1ae0e">generate_compressed_matrix_row_info_extractor</a>(source, numeric_string);
<a name="l01076"></a>01076               <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a76a7d90884ad785f48b0c957a8fa31a3">generate_compressed_matrix_vec_mul</a>(source, numeric_string);
<a name="l01077"></a>01077               <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a68f00e6161b75c39a5b0fe467a8f7197">generate_compressed_matrix_vec_mul4</a>(source, numeric_string);
<a name="l01078"></a>01078               <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a53ccc778ba6a11741e679311c49f2c96">generate_compressed_matrix_vec_mul8</a>(source, numeric_string);
<a name="l01079"></a>01079               <a class="code" href="namespaceviennacl_1_1linalg_1_1opencl_1_1kernels.html#a4b93c996bb01d31bf70d104779cc4282">generate_compressed_matrix_vec_mul_cpu</a>(source, numeric_string);
<a name="l01080"></a>01080 
<a name="l01081"></a>01081               std::string prog_name = <a class="code" href="structviennacl_1_1linalg_1_1opencl_1_1kernels_1_1compressed__matrix.html#adb4613919bae5cf962e40b99da83dd96">program_name</a>();
<a name="l01082"></a>01082 <span class="preprocessor">              #ifdef VIENNACL_BUILD_INFO</span>
<a name="l01083"></a>01083 <span class="preprocessor"></span>              std::cout &lt;&lt; <span class="stringliteral">&quot;Creating program &quot;</span> &lt;&lt; prog_name &lt;&lt; std::endl;
<a name="l01084"></a>01084 <span class="preprocessor">              #endif</span>
<a name="l01085"></a>01085 <span class="preprocessor"></span>              ctx.add_program(source, prog_name);
<a name="l01086"></a>01086               init_done[ctx.handle().get()] = <span class="keyword">true</span>;
<a name="l01087"></a>01087             } <span class="comment">//if</span>
<a name="l01088"></a>01088           } <span class="comment">//init</span>
<a name="l01089"></a>01089         };
<a name="l01090"></a>01090 
<a name="l01091"></a>01091       }  <span class="comment">// namespace kernels</span>
<a name="l01092"></a>01092     }  <span class="comment">// namespace opencl</span>
<a name="l01093"></a>01093   }  <span class="comment">// namespace linalg</span>
<a name="l01094"></a>01094 }  <span class="comment">// namespace viennacl</span>
<a name="l01095"></a>01095 <span class="preprocessor">#endif</span>
<a name="l01096"></a>01096 <span class="preprocessor"></span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 15 2014 22:19:33 for ViennaCL - The Vienna Computing Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
